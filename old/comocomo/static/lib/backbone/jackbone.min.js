!function(){"use strict";var e,t=this;e="undefined"!=typeof exports?exports:t.Jackbone={};var n=t.Backbone;n||"undefined"==typeof require||(n=require("backbone"));var o=t._;o||"undefined"==typeof require||(o=require("underscore"));var i=n.$;o.extend(e,n),e.VERSION="0.4.0";var r=Array.prototype.slice,a=e.profiler={enabled:!1,stats:{},_startDate:{},_timerConsoleName:{},onStart:function(e,t){if(this.enabled){var n=o.uniqueId("jt");return this._startDate[n]=e||+new Date,console.profile&&t&&(this._timerConsoleName[n]=t,console.profile(t)),n}},onEnd:function(e,t,n){if(this.enabled)if(this._startDate[e]){var o=(n||+new Date)-this._startDate[e];if(delete this._startDate[e],console.profile&&this._timerConsoleName[e]&&(console.profileEnd(this._timerConsoleName[e]),delete this._timerConsoleName[e]),"undefined"!=typeof this.stats[t]){var i=this.stats[t];i.calls+=1,i.totalMs+=o,o>i.maxMs&&(i.maxMs=o)}else this.stats[t]={calls:1,totalMs:o,maxMs:o};console.log("time("+t+") = "+o+"ms")}else console.log("WARNING: invalid profiling timer")}},s=e.View=function(e){this.subviews=[],this.back={title:"Back",hash:""},n.View.apply(this,arguments),e&&this.setOptions(e)};s.extend=n.View.extend,o.extend(s.prototype,n.View.prototype,{setOptions:function(e){this.options=e,e.back&&(this.back=e.back),this.callSubviews("setOptions",e),this.applyOptions(e)},callSubviews:function(e){if(0!==this.subviews.length){var t=r.call(arguments);t.shift(),o.each(this.subviews,function(n){n[e]&&n[e].apply(n,t)})}},_setup:function(){this.callSubviews("_setup"),this.bindEvents(),this.delegateEvents()},_clean:function(){this.callSubviews("_clean"),this.unbindEvents(),this.undelegateEvents()},applyOptions:function(){},bindEvents:function(){},unbindEvents:function(){this.stopListening()},refresh:function(){this.callSubviews("refresh")},onPageBeforeCreate:function(){this.callSubviews("onPageBeforeCreate")},onPageCreate:function(){this.callSubviews("onPageCreate")},onPageManualCreate:function(){this.callSubviews("onPageManualCreate")},onPageBeforeShow:function(){this.callSubviews("onPageBeforeShow")},onPageShow:function(){this.callSubviews("onPageShow")},onPageBeforeHide:function(){this.callSubviews("onPageBeforeHide")},onPageHide:function(){this.callSubviews("onPageHide")},events:{vclick:"defaultEvent"},defaultEvent:function(t){t.preventDefault();for(var n=i(t.target);n;){var o=n.attr("route");if(o)return"back"===o?e.router.goto(this.back.hash):e.router.goto(o),!1;var r=n.parent();n=r.length>0?r:!1}return!0},ignoreEvent:function(e){return e&&e.preventDefault&&e.preventDefault(),!1}});var l=e.Header=function(){s.apply(this,arguments)};l.extend=s.extend,o.extend(l.prototype,e.View.prototype);var h=e.Footer=function(){s.apply(this,arguments)};h.extend=s.extend,o.extend(h.prototype,e.View.prototype);var u=function(e,t,o){n.View.apply(this,[]),this.header=e,this.footer=o,this.content=t,this.needRedraw=!0,this.needSetup=!0,this.subviews=[],e&&(e.content=t,e.footer=o,e.root=this,this.subviews.push(e)),o&&(o.content=t,o.header=e,o.root=this,this.subviews.push(o)),t&&(t.header=e,t.footer=o,t.root=this,this.subviews.push(t))};o.extend(u.prototype,n.View.prototype,{setOptions:function(e){this.callSubviews("setOptions",e)},callSubviews:s.prototype.callSubviews,render:function(){if(this.needRedraw){var e=document.createElement("div");if(e.style.display="block",e.setAttribute("data-role","page"),this.header){var t=document.createElement("div");t.setAttribute("data-role","header"),this.header.setElement(t),this.header.render(),e.appendChild(t)}var n=document.createElement("div");if(n.setAttribute("data-role","content"),n.className="content",this.content.setElement(n),this.content.render(),this.header||(n.style.top="0"),this.footer||(n.style.bottom="0"),e.appendChild(n),this.footer){var o=document.createElement("div");o.setAttribute("data-role","footer"),this.footer.setElement(o),this.footer.render(),e.appendChild(o)}this.el.firstChild?this.el.replaceChild(e,this.el.firstChild):this.el.appendChild(e),this.needRedraw=!1}},events:{pagebeforehide:"_onPageBeforeHide",pagehide:"_onPageHide",pagebeforeshow:"_onPageBeforeShow",pageshow:"_onPageShow",pagebeforecreate:"_onPageBeforeCreate",pagecreate:"_onPageCreate"},_onPageBeforeHide:function(){this.callSubviews("onPageBeforeHide"),this.clean()},_onPageHide:function(){this.undelegateEvents(),this.callSubviews("onPageHide")},_onPageBeforeShow:function(){this.callSubviews("onPageBeforeShow"),this.enable()},_onPageShow:function(){this.setup(),this.callSubviews("onPageShow")},_onPageBeforeCreate:function(){this.callSubviews("onPageBeforeCreate")},_onPageCreate:function(){this.callSubviews("onPageCreate")},_onPageManualCreate:function(){this.callSubviews("onPageManualCreate")},setup:function(){this.needSetup&&(this.callSubviews("_setup"),this.needSetup=!1)},clean:function(){this.needSetup||(this.callSubviews("_clean"),this.needSetup=!0)},refresh:function(){this.callSubviews("refresh")},disable:function(){this.$el.addClass("ui-disabled")},enable:function(){this.$el.removeClass("ui-disabled")}}),e.Listview={updateJSON:function(e,t,n,o){for(var r=e.length?e[0]:e,a=0,s=r.childNodes;a<t.length&&a<s.length;)n.setLi(s[a],t[a]),++a;for(;a<t.length;)i(r).append(n.newLi(t[a])),++a;for(var l=s.length-1;l>=a;)r.removeChild(s[l]),--l;o!==!1&&i(r).listview("refresh")},update:function(e,t,n,i){var r=o(t.models).map(function(e){var t=o.clone(e.attributes);return o.extend(t,{id:e.id,cid:e.cid}),t});this.updateJSON(e,r,n,i)}},e.DefaultHeader=null,e.DefaultFooter=null;var c=e.Controller=function(e){this._configure(e||{}),this.view=null,this.initialize.apply(this,arguments)};c.extend=s.extend;var f=["model","collection"];o.extend(e.Controller.prototype,n.Events,{refresh:function(e){e()},firstRefresh:function(e){this.refresh(e)},initialize:function(){this.view=null},setOptions:function(e){this.applyOptions(e),this._rootView&&this._rootView.setOptions(e)},applyOptions:function(){},destroy:function(){},bindEvents:function(){},unbindEvents:function(){this.stopListening()},_configure:function(e){this.options&&(e=o.extend({},o.result(this,"options"),e)),o.extend(this,o.pick(e,f)),this.options=e}});var d=e.ViewManager={views:{},controllers:{},currentController:null,setCurrentController:function(e){e!==this.currentController&&(this.currentController&&this.currentController.unbindEvents(),this.currentController=e,this.currentController&&this.currentController.bindEvents())},_clearControllers:function(){var t=this,n=+new Date,i=o(this.controllers).filter(function(e){var t=n-e.lastView;return t>6e4});o(i).each(function(n){n.controller!==t.currentController&&(delete t.controllers[n.pageUID],n.controller.destroy(),n.controller._rootView&&(n.controller._rootView.clean(),n.controller._rootView.remove(),e.trigger("destroyview",n.controller._rootView)))})},forceGarbageCollection:function(){o(this.controllers).each(function(e){e.lastView=0}),this._clearControllers()},createWithView:function(t,n){var i,r=t.name,a=t.Class,s=t.options||{},l=t.extra,h=r+JSON.stringify(s).replace(/["{}]/g,"");if(l&&(s=o.extend(s,l)),s&&s.backhash&&(s.back={title:s.backtitle||"Back",hash:s.backhash}),"undefined"!=typeof this.views[h])i=this.views[h];else{var c=s&&s.noHeader||!e.DefaultHeader,f=s&&s.noFooter||!e.DefaultFooter,d=new a,p=c?null:new e.DefaultHeader,g=f?null:new e.DefaultFooter;i=new u(p,d,g),this.views[h]=i}i.setOptions(s),this.setCurrentController(null),i._pageUID=h,"function"==typeof n&&n(i)},runGC:0,_openInProgress:0,createWithController:function(t,n){var i=this,r=t.name,a=t.Class,s=t.options||{},l=t.extra,h=r+JSON.stringify(s).replace(/["{}]/g,"");this._openInProgress=h,this.runGC+=1,this.runGC>5&&(this.runGC=0,this._clearControllers()),l&&(s=o.extend(s,l)),s&&s.backhash&&(s.back={title:s.backtitle||"Back",hash:s.backhash});var c=null,f=function(){i.controllers[h]&&h===i._openInProgress&&(i.setCurrentController(c),i.controllers[h].lastView=+new Date,c._rootView.setOptions(c.options),c._rootView._pageUID=h,"function"==typeof n&&n(c._rootView))};if("undefined"!=typeof this.controllers[h])c=this.controllers[h].controller,"function"==typeof c.refresh?c.refresh(f):f();else{var d=s&&s.noHeader||!e.DefaultHeader,p=s&&s.noFooter||!e.DefaultFooter;c=new a(s);var g=function(){var t=c.view,n=d?null:new e.DefaultHeader,o=p?null:new e.DefaultFooter,r=new u(n,t,o);i.controllers[h]={pageUID:h,controller:c},c._rootView=r,r.controller=c,f()};"function"==typeof c.firstRefresh?c.firstRefresh(g):g()}}},p=e.Router=function(){n.Router.apply(this,arguments),e.router||(e.router=this,e.configureJQM())};p.extend=n.Router.extend;var g=function(e,t,n){var o=t;return"undefined"!=typeof n&&(n&&n.length?0!==n.length&&(o=t+e+n.join(e)):o=t+e+n),o};o.extend(p.prototype,n.Router.prototype,{"goto":function(e,t){this.navigate(this.getPageHash(e,t),{trigger:!0})},getPageName:function(e,t){return g("_",e,t)},getPageHash:function(e,t){return g("?",e,t)},_openInProgress:!1,_openWithViewManager:function(t,n){var o=+new Date;if(o-this._openInProgress<300)return!1;this._openInProgress=o;var i=a.onStart(o,t.name);t.extra||(t.extra={}),t.extra.backhash||(t.extra.backhash=this.currentHash);var r=this,s=function(o){r._openInProgress=!1,r.changePage(o._pageUID.replace(/\W/g,"-"),o,t.role),e.trigger("openview",o),a.onEnd(i,o._pageUID),"function"==typeof n&&n(o)};d[t.method](t,s)},openView:function(e,t){var n=o.extend({},e,{method:"createWithView"});this._openWithViewManager(n,t)},openDialog:function(e,t){var n=o.extend({},e,{method:"createWithView",role:"dialog"});this._openWithViewManager(n,t)},openViewController:function(e,t){var n=o.extend({},e,{method:"createWithController"});this._openWithViewManager(n,t)},openDialogController:function(e,t){var n=o.extend({},e,{method:"createWithController",role:"dialog"});this._openWithViewManager(n,t)},changePage:function(t,n,o){var r="pagename-"+t.toLowerCase(),a=i("#"+r);if(1===a.length?n.needRedraw?n.render():(n.refresh(),n.delegateEvents()):(n.el.id="pagename-"+t.toLowerCase(),n.el.className="page-container",n.render(),document.body.appendChild(n.el),e.manualMode&&(n._onPageBeforeCreate(),n._onPageManualCreate(),n._onPageCreate())),e.manualMode)e.activePage&&(e.activePage._onPageBeforeHide(),e.activePage.$el.hide(),e.activePage._onPageHide()),n._onPageBeforeShow(),n.$el.show(),n._onPageShow(),e.activePage=n,i.mobile.activePage=n.$el;else{var s=this.selectTransition(t,o);i.mobile.changePage(n.$el,{changeHash:!1,transition:s.transition,reverse:s.reverse,role:o,pageContainer:n.$el})}this.currentHash=e.history.getFragment()},transitions:{},selectTransition:function(e,t){var n=this.currentPageName||"",r=this.currentPageRole||"";if(this.currentPageName=e,this.currentPageRole=t,o(this.transitions).has(n+"-->"+e))return this.transitions[n+"-->"+e];var a=i.mobile.defaultPageTransition;return("dialog"===t||"dialog"===r)&&(a=i.mobile.defaultDialogTransition),this.transitions[n+"-->"+e]={transition:a,reverse:!1},this.transitions[e+"-->"+n]={transition:a,reverse:!0},{transition:a,reverse:!1}}}),e.history=n.history,e.configureJQM=function(){i.mobile.ajaxEnabled=!1,i.mobile.linkBindingEnabled=!1,i.mobile.hashListeningEnabled=!1,i.mobile.pushStateEnabled=!1,i.mobile.touchOverflowEnabled=!0},e.manualMode=!1}.call(this);